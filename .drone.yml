kind: pipeline
type: docker
name: golangapi

steps:
- name: build
  image: golang
  commands:
  - go test -coverprofile coverage.out ./... && go tool cover -func coverage.out
  - go build app.go

- name: push
  image: docker
  commands:
  - docker build -t golang-api-${DRONE_COMMIT_SHA:0:7} .
  

trigger:
  event:
  - push
  branch:
  - docker

