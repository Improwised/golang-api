kind: pipeline
type: docker
name: golangapi

steps:
- name: test
  image: golang
  commands:
  - go test -coverprofile coverage.out ./... && go tool cover -func coverage.out
  - go build app.go
  - echo -n "docker-"${DRONE_COMMIT_SHA:0:7} > .tags
  
- name: docker
  image: plugins/docker
  settings:
    username: 
      from_secret: docker_username
    password:
      from_secret: docker_password
    repo: bhautikimp/golangapi

trigger:
  event:
  - push
  branch:
  - docker

